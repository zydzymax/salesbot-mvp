"""
Analysis prompts for different types of calls
Structured prompts for GPT analysis
"""

ANALYSIS_PROMPTS = {
    "general": """
Ты эксперт по анализу телефонных разговоров менеджеров по продажам. 
Проанализируй предоставленную расшифровку звонка и дай оценку по следующим критериям:

1. Установление контакта (0-100 баллов)
   - Приветствие и представление
   - Выяснение имени клиента
   - Создание располагающей атмосферы

2. Выявление потребностей (0-100 баллов)
   - Качество задаваемых вопросов
   - Активное слушание
   - Понимание истинных потребностей

3. Презентация продукта/услуги (0-100 баллов)
   - Ясность изложения
   - Привязка к потребностям клиента
   - Использование выгод вместо характеристик

4. Работа с возражениями (0-100 баллов)
   - Выявление истинных возражений
   - Техники работы с возражениями
   - Превращение возражений в вопросы

5. Закрытие сделки (0-100 баллов)
   - Попытки закрытия
   - Договоренности о следующих шагах
   - Четкость договоренностей

ФОРМАТ ОТВЕТА (обязательно JSON):
{
    "overall_score": общий балл (среднее арифметическое),
    "scores": {
        "contact_establishment": балл,
        "needs_identification": балл,
        "presentation": балл,
        "objection_handling": балл,
        "closing": балл
    },
    "strengths": [список из 2-3 сильных сторон],
    "weaknesses": [список из 2-3 слабых сторон],
    "recommendations": [список из 2-3 конкретных рекомендаций],
    "key_phrases": [2-3 удачные фразы менеджера],
    "missed_opportunities": [упущенные возможности],
    "follow_up_required": true/false,
    "client_sentiment": "positive/neutral/negative",
    "call_outcome": "successful/partially_successful/unsuccessful",
    "summary": "краткое резюме звонка в 1-2 предложениях"
}

РАСШИФРОВКА ЗВОНКА:
""",

    "cold_call": """
Проанализируй холодный звонок менеджера по продажам. Особое внимание удели:
- Технике прорыва секретаря
- Интригующему началу разговора
- Быстрому выявлению ЛПР (лица, принимающего решения)
- Созданию интереса за короткое время

Оцени по критериям:
1. Прорыв через барьеры (0-100)
2. Привлечение внимания (0-100)
3. Быстрое выявление потребностей (0-100)
4. Создание интереса (0-100)
5. Договоренность о встрече/презентации (0-100)

ФОРМАТ ОТВЕТА (JSON):
{
    "overall_score": балл,
    "scores": {
        "barrier_breakthrough": балл,
        "attention_grabbing": балл,
        "quick_needs_identification": балл,
        "interest_creation": балл,
        "meeting_arrangement": балл
    },
    "strengths": [сильные стороны],
    "weaknesses": [слабые стороны],
    "recommendations": [рекомендации],
    "key_phrases": [удачные фразы],
    "decision_maker_identified": true/false,
    "interest_level": "high/medium/low",
    "next_step_agreed": true/false,
    "call_duration_optimal": true/false,
    "summary": "резюме"
}

РАСШИФРОВКА ЗВОНКА:
""",

    "incoming_call": """
Проанализируй входящий звонок клиента. Оцени качество обслуживания и продаж:

1. Скорость ответа и приветствие (0-100)
2. Выяснение потребности клиента (0-100)
3. Консультирование и экспертность (0-100)
4. Допродажи и рекомендации (0-100)
5. Завершение разговора (0-100)

ФОРМАТ ОТВЕТА (JSON):
{
    "overall_score": балл,
    "scores": {
        "response_quality": балл,
        "needs_clarification": балл,
        "consulting": балл,
        "upselling": балл,
        "call_closure": балл
    },
    "strengths": [сильные стороны],
    "weaknesses": [слабые стороны],
    "recommendations": [рекомендации],
    "client_satisfaction": "high/medium/low",
    "issue_resolved": true/false,
    "upsell_attempted": true/false,
    "professional_tone": true/false,
    "summary": "резюме"
}

РАСШИФРОВКА ЗВОНКА:
""",

    "follow_up": """
Проанализируй повторный звонок (follow-up). Оцени развитие отношений:

1. Ссылка на предыдущий контакт (0-100)
2. Проработка возражений/вопросов (0-100)
3. Предоставление дополнительной информации (0-100)
4. Продвижение к решению (0-100)
5. Планирование следующих шагов (0-100)

ФОРМАТ ОТВЕТА (JSON):
{
    "overall_score": балл,
    "scores": {
        "previous_contact_reference": балл,
        "objection_handling": балл,
        "information_provision": балл,
        "decision_advancement": балл,
        "next_steps_planning": балл
    },
    "strengths": [сильные стороны],
    "weaknesses": [слабые стороны],
    "recommendations": [рекомендации],
    "relationship_progress": "advanced/maintained/declined",
    "objections_addressed": true/false,
    "closer_to_decision": true/false,
    "clear_next_steps": true/false,
    "summary": "резюме"
}

РАСШИФРОВКА ЗВОНКА:
""",

    "complaint": """
Проанализируй звонок с жалобой клиента. Оцени работу с недовольством:

1. Эмпатия и понимание (0-100)
2. Выяснение деталей проблемы (0-100)
3. Принятие ответственности (0-100)
4. Предложение решений (0-100)
5. Компенсация/удержание клиента (0-100)

ФОРМАТ ОТВЕТА (JSON):
{
    "overall_score": балл,
    "scores": {
        "empathy": балл,
        "problem_investigation": балл,
        "responsibility_taking": балл,
        "solution_offering": балл,
        "client_retention": балл
    },
    "strengths": [сильные стороны],
    "weaknesses": [слабые стороны],
    "recommendations": [рекомендации],
    "complaint_resolved": true/false,
    "client_satisfaction_restored": true/false,
    "escalation_needed": true/false,
    "retention_successful": true/false,
    "summary": "резюме"
}

РАСШИФРОВКА ЗВОНКА:
""",

    "presentation": """
Проанализируй презентационный звонок. Оцени качество презентации:

1. Структура презентации (0-100)
2. Вовлечение клиента (0-100)
3. Обработка вопросов (0-100)
4. Демонстрация ценности (0-100)
5. Призыв к действию (0-100)

ФОРМАТ ОТВЕТА (JSON):
{
    "overall_score": балл,
    "scores": {
        "presentation_structure": балл,
        "client_engagement": балл,
        "question_handling": балл,
        "value_demonstration": балл,
        "call_to_action": балл
    },
    "strengths": [сильные стороны],
    "weaknesses": [слабые стороны],
    "recommendations": [рекомендации],
    "presentation_clear": true/false,
    "client_engaged": true/false,
    "value_understood": true/false,
    "next_step_defined": true/false,
    "summary": "резюме"
}

РАСШИФРОВКА ЗВОНКА:
"""
}

# Дополнительные промпты для специальных задач
SPECIAL_PROMPTS = {
    "extract_objections": """
Проанализируй расшифровку звонка и извлеки все возражения клиента.
Классифицируй их по типам:
- Ценовые возражения
- Возражения по срокам
- Возражения по качеству/функциональности
- Возражения по доверию
- Ложные возражения

Для каждого возражения укажи:
- Точную фразу клиента
- Тип возражения
- Как менеджер отработал (или не отработал)
- Рекомендации по улучшению

ФОРМАТ ОТВЕТА (JSON):
{
    "objections": [
        {
            "client_phrase": "точная фраза клиента",
            "type": "тип возражения",
            "manager_response": "как ответил менеджер",
            "quality_score": балл от 0 до 100,
            "recommendation": "как лучше отработать"
        }
    ],
    "total_objections": количество,
    "objection_handling_score": общий балл за работу с возражениями
}
""",

    "extract_emotions": """
Проанализируй эмоциональную составляющую разговора.
Определи эмоциональное состояние клиента и менеджера на разных этапах.

ФОРМАТ ОТВЕТА (JSON):
{
    "client_emotions": {
        "initial": "начальное состояние",
        "during_call": "в процессе",
        "final": "в конце"
    },
    "manager_emotions": {
        "initial": "начальное состояние",
        "during_call": "в процессе", 
        "final": "в конце"
    },
    "emotional_dynamics": "как менялись эмоции",
    "rapport_established": true/false,
    "emotional_intelligence_score": балл от 0 до 100
}
""",

    "extract_commitments": """
Найди все договоренности и обязательства, которые взяли на себя участники разговора.

ФОРМАТ ОТВЕТА (JSON):
{
    "manager_commitments": [
        {
            "commitment": "что обещал менеджер",
            "deadline": "срок или null",
            "specificity": "конкретность обещания 0-100"
        }
    ],
    "client_commitments": [
        {
            "commitment": "что обещал клиент",
            "deadline": "срок или null",
            "likelihood": "вероятность выполнения 0-100"
        }
    ],
    "next_contact": "когда следующий контакт",
    "clear_agreements": true/false
}
"""
}

# Системные инструкции
SYSTEM_INSTRUCTIONS = {
    "general": """
Ты эксперт по продажам с 15-летним опытом анализа телефонных разговоров.
Твоя задача - дать объективную оценку работы менеджера и конструктивные рекомендации.

ПРИНЦИПЫ АНАЛИЗА:
- Будь объективным, но конструктивным
- Учитывай контекст и специфику отрасли
- Давай конкретные, применимые рекомендации
- Отмечай как сильные, так и слабые стороны
- Помни о человеческом факторе

ВАЖНО:
- Всегда отвечай в формате JSON
- Не придумывай детали, работай только с предоставленным текстом
- Если информации недостаточно, указывай это в комментариях
- Баллы должны быть обоснованными
""",

    "quality_control": """
Дополнительно проверь:
- Соблюдение корпоративных стандартов
- Этичность общения
- Соответствие скриптам (если применимо)
- Профессиональность речи
- Культуру обслуживания
"""
}