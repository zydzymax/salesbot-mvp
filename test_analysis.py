"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–≤–æ–Ω–∫–æ–≤
"""
import asyncio
import json
import sys
import os

# –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.insert(0, '/root/salesbot-mvp')

from app.analysis.pipeline import analyze_dialog
from app.config import get_settings

async def main():
    settings = get_settings()

    # –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–≤–æ–Ω–∫–∞
    dialogue_text = """–ú–µ–Ω–µ–¥–∂–µ—Ä: –í–µ–ª–∏—Ç–∞, –∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ.
–ö–ª–∏–µ–Ω—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ.
–ú–µ–Ω–µ–¥–∂–µ—Ä: –ú–µ–Ω—è –∑–æ–≤—É—Ç –û–ª—å–≥–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é —à–≤–µ–π–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –°–∞–≤–∞–Ω–µ–π. –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –µ—Å—Ç—å –ª–∏ —É –≤–∞—Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã –Ω–∞ –≤–∞—à–∏—Ö —Ç—Ä–∏–∫–æ—Ç–∞–∂–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π?
–ö–ª–∏–µ–Ω—Ç: –í–æ–æ–±—â–µ —É –Ω–∞—Å –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã.
–ú–µ–Ω–µ–¥–∂–µ—Ä: –ê —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –≤ —à–≤–µ–π–Ω–æ–π?
–ö–ª–∏–µ–Ω—Ç: –í—ã –∑–Ω–∞–µ—Ç–µ, —è –ø—Ä–æ—Å—Ç–æ —Å–µ–π—á–∞—Å —É–∂–µ —É–µ—Ö–∞–ª–∞. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –ø–æ–≥–æ–≤–æ—Ä–∏–º? –Ø —É–∂–µ –ø—Ä–æ—Å—Ç–æ —É–µ—Ö–∞–ª–∞. –¢–µ–º –±–æ–ª–µ–µ, —è –Ω–µ –≤ –ú–æ—Å–∫–≤–µ.
–ú–µ–Ω–µ–¥–∂–µ—Ä: –°–ø–∞—Å–∏–±–æ –≤–∞–º –±–æ–ª—å—à–æ–µ. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –ø–æ–æ–±—â–∞–µ–º—Å—è, –ª–∞–¥–Ω–æ?
–ö–ª–∏–µ–Ω—Ç: –°–ø–∞—Å–∏–±–æ –æ–≥—Ä–æ–º–Ω–æ–µ, –∏–∑–≤–∏–Ω–∏—Ç–µ.
–ú–µ–Ω–µ–¥–∂–µ—Ä: –í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è.
–ö–ª–∏–µ–Ω—Ç: –î–æ —Å–≤–∏–¥–∞–Ω–∏—è."""

    print("=" * 80)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–û–í–û–ì–û –ê–ù–ê–õ–ò–ó–ê –ó–í–û–ù–ö–û–í")
    print("=" * 80)
    print("\n–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–≤–æ–Ω–∫–∞:")
    print("-" * 80)
    print(dialogue_text)
    print("-" * 80)

    print("\nüîÑ –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ ChatGPT (gpt-4o)...")
    print(f"Model: gpt-4o")
    print(f"Temperature: 0.15")
    print(f"Prompt version: call_scoring.v1")

    try:
        result = await analyze_dialog(
            dialogue_text=dialogue_text,
            api_key=settings.OPENAI_API_KEY,
            model="gpt-4o",
            temperature=0.15,
            max_retries=2
        )

        print("\n" + "=" * 80)
        print("‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢ –ê–ù–ê–õ–ò–ó–ê")
        print("=" * 80)
        print(json.dumps(result, indent=2, ensure_ascii=False))

    except Exception as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    asyncio.run(main())
